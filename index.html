<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport"
      content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
<title>Jogo Ônibus — Modo Horizontal com Muro Azul</title>
<style>
:root{
  --arrow-size:min(84px,11vw);
  --arrow-gap:22px;
}
html,body{
  margin:0;padding:0;
  height:100%;width:100%;
  overflow:hidden;
  background:#c1e8ff;
  font-family:Arial,Helvetica,sans-serif;
}
body{
  padding-top:env(safe-area-inset-top);
  padding-bottom:env(safe-area-inset-bottom);
  padding-left:env(safe-area-inset-left);
  padding-right:env(safe-area-inset-right);
}
#game{
  position:fixed;
  inset:0;
  width:100vw;
  height:100vh;
  display:block;
  background:#c1e8ff;
  touch-action:none;
}
.arrow{
  position:fixed;right:12px;
  width:var(--arrow-size);height:var(--arrow-size);
  background:rgba(255,210,0,.45);
  clip-path:polygon(50% 0%,100% 100%,0% 100%);
  border:2px solid rgba(0,0,0,.6);border-radius:8px;
  z-index:30;display:flex;align-items:center;justify-content:center;
  cursor:pointer;
}
#up{top:calc(50% - var(--arrow-gap) - var(--arrow-size));}
#down{top:calc(50% + var(--arrow-gap));transform:rotate(180deg);}
#score{
  position:fixed;left:12px;top:12px;z-index:35;
  background:rgba(255,255,255,.92);color:#111;
  padding:.45rem .85rem;border-radius:.5rem;font-weight:700;
  box-shadow:0 4px 10px rgba(0,0,0,.12);
}
#overlay{
  position:fixed;inset:0;display:none;place-items:center;
  z-index:60;background:rgba(0,0,0,.55);color:#fff;text-align:center;
}
.card{
  display:flex;flex-direction:column;align-items:center;gap:8px;
}
.card img{
  width:20vw;max-width:160px;
  filter:drop-shadow(0 8px 18px rgba(0,0,0,.35));
}
.restart-btn{
  margin-top:4px;width:20vw;height:4.5vh;max-width:120px;
  font-size:0.9rem;border:none;border-radius:8px;
  background:#ffd200;color:#111;font-weight:700;
  text-transform:uppercase;cursor:pointer;
  box-shadow:0 4px 10px rgba(0,0,0,.25);
}
/* BLOQUEIO RETRATO */
#portraitOverlay{
  position:fixed;inset:0;z-index:100;display:none;
  align-items:center;justify-content:center;
  background:#c1e8ff;
}
#portraitOverlay .box{
  background:#fff;border-radius:12px;padding:24px 28px;
  text-align:center;box-shadow:0 4px 16px rgba(0,0,0,.15);
  max-width:280px;
}
#portraitOverlay h2{margin:0 0 8px;font-size:1.4rem;color:#111;}
#portraitOverlay p{margin:0;color:#333;font-size:1rem;}
</style>
</head>
<body>

<!-- BLOQUEIO DE ORIENTAÇÃO -->
<div id="portraitOverlay">
  <div class="box">
    <h2>Gire o celular</h2>
    <p>O jogo funciona apenas no modo horizontal.</p>
  </div>
</div>

<div id="score">Score: 0</div>
<canvas id="game"></canvas>
<button id="up" class="arrow"></button>
<button id="down" class="arrow"></button>

<div id="overlay">
  <div class="card">
    <img src="https://i.imgur.com/0pLRZmP.png" alt="Game Over">
    <button id="restartBtn" class="restart-btn">RECOMEÇAR</button>
  </div>
</div>

<script>
/* === BLOQUEIO DE ORIENTAÇÃO === */
function checkOrientation(){
  const overlay=document.getElementById("portraitOverlay");
  overlay.style.display = (window.innerHeight > window.innerWidth) ? "flex" : "none";
}
window.addEventListener("resize",checkOrientation);
window.addEventListener("orientationchange",checkOrientation);
checkOrientation();

/* === SOM === */
const SND={
  motor:new Audio("https://cdn1.suno.ai/ad092ffb-b86d-4724-9885-f1fa614181d1.mp3"),
  crash:new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_5f0c50e56b.mp3?filename=car-crash-impact-178032.mp3")
};
SND.motor.loop=true;SND.motor.volume=0.45;SND.crash.volume=0.8;
document.addEventListener("click",()=>{SND.motor.play().then(()=>SND.motor.pause());SND.crash.play().then(()=>SND.crash.pause());},{once:true});

/* === IMAGENS === */
const IMG={
  bus:'https://i.imgur.com/0oAgd0Z.png',
  chef:'https://i.imgur.com/eG4k5ZG.png',
  bg:'https://i.imgur.com/vaDSZw1.jpeg',
  tree:'https://i.imgur.com/8fumTkM.png',
  bench:'https://i.imgur.com/lcMO0E1.png',
  lamp:'https://i.imgur.com/jYu49kJ.png',
  hydrant:'https://i.imgur.com/zBnBrHr.png',
  rat:'https://i.imgur.com/WRubhRO.png',
  manhole:'https://i.imgur.com/bYlEW1N.png'
};

/* === JOGO === */
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
const btnUp=document.getElementById("up");
const btnDown=document.getElementById("down");
const overlay=document.getElementById("overlay");
const restartBtn=document.getElementById("restartBtn");
const scoreEl=document.getElementById("score");

let W=0,H=0,roadTop=0,roadH=0,lanesY=[];
let bus,bgImg,chefImg,treeImg,benchImg,lampImg,hydrantImg,ratImg,manholeImg;
let obstacles=[],landscapes=[];
let speed=180,BASE_SPEED=180,MAX_SPEED=520,score=0,lastSpawn=0,lastLandscape=0,lastTime=0,roadPhase=0;
let running=true;
const SPAWN_OBS_MS=2700,SPAWN_LAND_MS=3500,MAX_OBS=3;

const loadImage=src=>new Promise((res,rej)=>{
  const i=new Image();i.crossOrigin="anonymous";
  i.onload=()=>res(i);i.onerror=()=>rej(src);i.src=src;
});

Promise.all([
  loadImage(IMG.bus),loadImage(IMG.bg),loadImage(IMG.chef),
  loadImage(IMG.tree),loadImage(IMG.bench),loadImage(IMG.lamp),
  loadImage(IMG.hydrant),loadImage(IMG.rat),loadImage(IMG.manhole)
]).then(([busImg,bg,chef,tree,bench,lamp,hydrant,rat,manhole])=>{
  bus={img:busImg,x:0,y:0,w:0,h:0,lane:0,hitScaleW:.38,hitScaleH:.25};
  bgImg=bg;chefImg=chef;treeImg=tree;benchImg=bench;
  lampImg=lamp;hydrantImg=hydrant;ratImg=rat;manholeImg=manhole;
  resize();requestAnimationFrame(loop);
});

/* === AJUSTE RESPONSIVO === */
function resize(){
  const dpr=Math.max(1,window.devicePixelRatio||1);
  canvas.width=innerWidth*dpr;
  canvas.height=innerHeight*dpr;
  ctx.setTransform(dpr,0,0,dpr,0,0);
  W=innerWidth;H=innerHeight;
  roadH=H*0.70;roadTop=H-roadH;
  const faixa1=roadTop+roadH*0.16,faixa2=roadTop+roadH*0.16;
  lanesY=[faixa1,faixa2];
  const bw=W*(W>900?0.20:0.20);
  const r=bus.img.width/bus.img.height;
  bus.w=bw;bus.h=bw/r;bus.x=W*0.18;bus.y=lanesY[bus.lane];
  running=true;
}
addEventListener("resize",()=>setTimeout(resize,300));

/* === CÉU === */
function drawSky(){
  const g=ctx.createLinearGradient(0,0,0,roadTop);
  g.addColorStop(0,"#c1e8ff");g.addColorStop(1,"#b7e2ff");
  ctx.fillStyle=g;ctx.fillRect(0,0,W,roadTop);
}

/* === CENÁRIO DAS LOJAS === */
function drawBg(dt){
  const move=(running?dt:0)*speed*0.3;
  drawBg.off=(drawBg.off||0)-move;
  const s=(roadTop*0.90)/bgImg.height;
  const w=bgImg.width*s,h=bgImg.height*s;
  const y=roadTop-h+roadH*0.005;
  let xStart=(drawBg.off%w)-w;
  for(let x=xStart;x<W+w;x+=w) ctx.drawImage(bgImg,x,y,w,h);
}

/* === MURO AZUL CLARO === */
const wallCanvas=(()=>{
  const p=document.createElement("canvas");
  p.width=400;p.height=50;
  const c=p.getContext("2d");
  const bw=18,bh=12;
  for(let j=0;j<p.height/bh+1;j++){
    for(let i=0;i<p.width/bw+1;i++){
      const off=(j%2)*bw/2;
      const bx=i*bw-off;
      const toneR=80,toneG=200,toneB=220;
      const grad=c.createLinearGradient(bx,j*bh,bx,j*bh+bh);
      grad.addColorStop(0,`rgb(${toneR+20},${toneG+20},${toneB+20})`);
      grad.addColorStop(1,`rgb(${toneR-20},${toneG-20},${toneB-20})`);
      c.fillStyle=grad;
      c.fillRect(bx,j*bh,bw,bh);
      c.strokeStyle="rgba(0,60,70,0.25)";
      c.lineWidth=0.5;
      c.strokeRect(bx,j*bh,bw,bh);
    }
  }
  return p;
})();

function drawMovingWall(dt){
  const move=(running?dt:0)*speed*0.3;
  drawMovingWall.off=(drawMovingWall.off||0)-move;
  const wh=roadH*0.08;
  const y=roadTop-roadH*0.08-wh;
  for(let x=(drawMovingWall.off%wallCanvas.width)-wallCanvas.width;
      x<W+wallCanvas.width;x+=wallCanvas.width)
    ctx.drawImage(wallCanvas,x,y,wallCanvas.width,wh);
}

/* === ITENS DO CENÁRIO === */
function spawnLandscape(){
  const imgs=[treeImg,benchImg,lampImg,hydrantImg,ratImg,manholeImg];
  const img=imgs[Math.floor(Math.random()*imgs.length)];
  let scale=0.18;
  if(img===benchImg) scale*=0.6;
  if(img===treeImg) scale*=1.08;
  if(img===lampImg) scale*=1.1;
  if(img===hydrantImg) scale*=0.3;
  if(img===manholeImg) scale*=0.5;
  const w=img.width*scale,h=img.height*scale;
  const sidewalkH=roadH*0.2;
  let y=roadTop - sidewalkH*0.15 + 12;
  if(img===benchImg) y+=8;
  if(img===ratImg) y=roadTop + roadH*0.65;
  if(img===manholeImg) y=roadTop + roadH*0.7;
  landscapes.push({img,x:W+150,y,w,h});
}
function drawLandscapes(dt){
  const move=(running?dt:0)*speed*0.4;
  for(let i=landscapes.length-1;i>=0;i--){
    const l=landscapes[i];
    l.x -= move;
    ctx.drawImage(l.img,l.x-l.w/2,l.y-l.h,l.w,l.h);
    if(l.x+l.w<-150)landscapes.splice(i,1);
  }
}

/* === ESTRADA / ÔNIBUS / OBSTÁCULOS === */
function drawRoad(dt){
  ctx.fillStyle="#2f2f2f";ctx.fillRect(0,roadTop,W,roadH);
  roadPhase+=speed*(running?dt:0);
  const dash=140,gap=100,h=4,y=roadTop+roadH*0.5-h/2;
  const period=dash+gap,start=-dash-(roadPhase%period);
  ctx.fillStyle="#ffd200";
  for(let x=start;x<W+period;x+=period)
    ctx.fillRect(x,y,dash,h*1.6);
}
function drawBus(){ ctx.drawImage(bus.img,bus.x-bus.w/2,bus.y-bus.h/2,bus.w,bus.h); }
function spawnObstacle(){
  if(obstacles.length>=MAX_OBS)return;
  const lane=Math.random()<.5?0:1;
  const targetH=roadH*0.4,r=chefImg.width/chefImg.height;
  const h=targetH,w=h*r;
  const lastX=obstacles.length?obstacles[obstacles.length-1].x:0;
  const xStart=Math.max(W+w+240,lastX+420+Math.random()*300);
  const y=lanesY[lane];
  obstacles.push({img:chefImg,x:xStart,y,w,h});
}
function drawObstacles(dt){
  for(let i=obstacles.length-1;i>=0;i--){
    const o=obstacles[i];
    if(running)o.x-=speed*dt;
    ctx.drawImage(o.img,o.x-o.w/2,o.y-o.h/2,o.w,o.h);
    if(o.x+o.w<-150)obstacles.splice(i,1);
  }
}
function collided(){
  const bw=bus.w*bus.hitScaleW,bh=bus.h*bus.hitScaleH;
  const bx=bus.x-bw/2,by=bus.y-bh/2;
  for(const o of obstacles){
    const ox=o.x-o.w/2,oy=o.y-o.h/2;
    if(bx<ox+o.w && bx+bw>ox && by<oy+o.h && by+bh>oy)return true;
  }
  return false;
}

/* === CONTROLES === */
btnUp.onclick=()=>{if(running){bus.lane=Math.max(0,bus.lane-1);bus.y=lanesY[bus.lane];}};
btnDown.onclick=()=>{if(running){bus.lane=Math.min(1,bus.lane+1);bus.y=lanesY[bus.lane];}};
addEventListener("keydown",e=>{
  if(e.key==="ArrowUp")btnUp.onclick();
  else if(e.key==="ArrowDown")btnDown.onclick();
});

/* === REINÍCIO === */
function restart(){
  obstacles=[];landscapes=[];score=0;speed=BASE_SPEED;
  bus.lane=0;bus.y=lanesY[0];
  overlay.style.display="none";running=true;
  SND.motor.currentTime=0;SND.motor.play();
}
restartBtn.onclick=restart;

/* === LOOP === */
function loop(t){
  if(!lastTime)lastTime=t;
  const dt=Math.min(.033,(t-lastTime)/1000);
  lastTime=t;
  if(running){
    lastSpawn+=dt*1000;lastLandscape+=dt*1000;
    if(lastSpawn>=SPAWN_OBS_MS){spawnObstacle();lastSpawn=0;}
    if(lastLandscape>=SPAWN_LAND_MS){spawnLandscape();lastLandscape=0;}
    speed=Math.min(MAX_SPEED,BASE_SPEED+score*0.15);
    score+=dt*60;scoreEl.textContent="Score: "+Math.floor(score);
    if(SND.motor.paused)SND.motor.play();
  }
  ctx.clearRect(0,0,W,H);
  drawSky();drawBg(dt);drawMovingWall(dt);
  drawLandscapes(dt);drawRoad(dt);drawObstacles(dt);drawBus();
  if(running&&collided()){
    running=false;overlay.style.display="grid";
    SND.motor.pause();SND.crash.currentTime=0;SND.crash.play();
  }
  requestAnimationFrame(loop);
}
</script>
</body>
</html>
